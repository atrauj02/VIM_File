<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Aplikasi Akuntansi Sederhana</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Times New Roman', Times, serif, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, white 0%, black 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: blue;
            border-radius: 15px;
            box-shadow: 0 20px 60px grey;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, black, red 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .auth-status {
            position: absolute;
            top: 15px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .auth-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            background: rgba(255,255,255,0.2);
        }

        .auth-badge.viewer {
            background: #ffc107;
            color: #000;
        }

        .auth-badge.editor {
            background: #28a745;
            color: white;
        }

        .logout-btn {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            transition: all 0.3s;
        }

        .logout-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
        }

        .nav-tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            color: #495057;
            transition: all 0.3s;
        }

        .nav-tab:hover {
            background: #e9ecef;
        }

        .nav-tab.active {
            background: white;
            color: #667eea;
            border-bottom: 3px solid #667eea;
        }

        .tab-content {
            display: none;
            padding: 30px;
        }

        .tab-content.active {
            display: block;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .card h3 {
            font-size: 14px;
            margin-bottom: 10px;
            opacity: 0.9;
        }

        .card .amount {
            font-size: 28px;
            font-weight: bold;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-danger {
            background: #dc3545;
            color: white;
            padding: 8px 15px;
            font-size: 14px;
        }

        .btn-danger:hover {
            background: #c82333;
        }

        .btn-danger:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-warning {
            background: #ffc107;
            color: #000;
            padding: 8px 15px;
            font-size: 14px;
            margin-right: 5px;
        }

        .btn-warning:hover {
            background: #e0a800;
        }

        .btn-warning:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .toggle-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 15px 0;
            user-select: none;
            transition: all 0.3s;
        }

        .toggle-header:hover {
            color: #667eea;
        }

        .toggle-header h3 {
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .toggle-arrow {
            font-size: 1.2em;
            transition: transform 0.3s ease;
            display: inline-block;
        }

        .toggle-arrow.collapsed {
            transform: rotate(-90deg);
        }

        .collapsible-content {
            max-height: 2000px;
            overflow: hidden;
            transition: max-height 0.3s ease, opacity 0.3s ease;
            opacity: 1;
        }

        .collapsible-content.collapsed {
            max-height: 0;
            opacity: 0;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        table thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        table th,
        table td {
            padding: 15px;
            text-align: left;
        }

        table tbody tr {
            border-bottom: 1px solid #e0e0e0;
        }

        table tbody tr:hover {
            background: #f8f9fa;
        }

        .income {
            color: #28a745;
            font-weight: 600;
        }

        .expense {
            color: #dc3545;
            font-weight: 600;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .report-section {
            margin-bottom: 30px;
        }

        .report-section h3 {
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }

        .no-data {
            text-align: center;
            padding: 40px;
            color: #999;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 40px;
            border-radius: 20px;
            width: 90%;
            max-width: 450px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
        }

        .modal-content h2 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.8em;
        }

        .modal-content p {
            margin-bottom: 25px;
            color: #666;
            font-size: 1.1em;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .modal-buttons button {
            flex: 1;
            padding: 12px 20px;
        }

        .locked-overlay {
            position: relative;
            pointer-events: none;
            opacity: 0.6;
        }

        .locked-overlay::after {
            content: 'üîí Anda tidak dapat Mengedit';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(255,255,255,0.95);
            padding: 20px 40px;
            border-radius: 15px;
            font-weight: 600;
            color: #666;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 10;
            pointer-events: none;
        }

        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }

            .nav-tabs {
                flex-direction: column;
            }

            table {
                font-size: 12px;
            }

            table th,
            table td {
                padding: 10px 5px;
            }

            .auth-status {
                position: static;
                justify-content: center;
                margin-top: 15px;
            }

            .header h1 {
                font-size: 1.8em;
            }
        }
    </style>
</head>
<body>
    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2>üîê Login Dashboard</h2>
            <p>Pilih mode akses Anda:</p>
            <div class="form-group">
                <input type="password" id="passwordInput" placeholder="Masukkan password (opsional)" style="margin-bottom: 15px;">
                <small style="color: #999;">Kosongkan password untuk mode Viewer</small>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="loginAsViewer()">Lihat Saja</button>
                <button class="btn btn-primary" onclick="loginWithPassword()">Login sebagai Editor</button>
            </div>
        </div>
    </div>

    <!-- Edit Transaction Modal -->
    <div id="editModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h2>‚úèÔ∏è Edit Transaksi</h2>
            <form id="editTransactionForm">
                <div class="form-group">
                    <label for="editTanggal">Tanggal</label>
                    <input type="date" id="editTanggal" required>
                </div>

                <div class="form-group">
                    <label for="editTipe">Tipe Transaksi</label>
                    <select id="editTipe" required>
                        <option value="">Pilih Tipe</option>
                        <option value="income">Pemasukan</option>
                        <option value="expense">Pengeluaran</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editKategori">Kategori</label>
                    <select id="editKategori" required>
                        <option value="">Pilih Kategori</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="editJumlah">Jumlah (Rp)</label>
                    <input type="number" id="editJumlah" min="0" step="1000" required>
                </div>

                <div class="form-group">
                    <label for="editKeterangan">Keterangan</label>
                    <textarea id="editKeterangan" rows="3" placeholder="Masukkan keterangan transaksi..."></textarea>
                </div>

                <div class="modal-buttons">
                    <button type="button" class="btn" style="background: #6c757d; color: white;" onclick="closeEditModal()">Batal</button>
                    <button type="submit" class="btn btn-primary">Simpan Perubahan</button>
                </div>
            </form>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="auth-status">
                <span class="auth-badge viewer" id="authBadge">Viewer</span>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
            <h1>Laporan Unit Bisnis</h1>
            <p>Yayasan Visi Insan Mulia</p>
        </div>

        <div class="nav-tabs">
            <button class="nav-tab active" onclick="showTab('dashboard')">Dashboard</button>
            <button class="nav-tab" onclick="showTab('transaksi')">Transaksi</button>
            <button class="nav-tab" onclick="showTab('laporan')">Laporan</button>
            <button class="nav-tab" onclick="showTab('Kategori')">Kategori</button>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2 style="margin-bottom: 20px; color: #333;">Dashboard Keuangan</h2>
            <div class="dashboard-grid">
                <div class="card">
                    <h3>Total Pemasukan</h3>
                    <div class="amount" id="totalIncome">Rp 0</div>
                </div>
                <div class="card">
                    <h3>Total Pengeluaran</h3>
                    <div class="amount" id="totalExpense">Rp 0</div>
                </div>
                <div class="card">
                    <h3>Saldo</h3>
                    <div class="amount" id="balance">Rp 0</div>
                </div>
                <div class="card">
                    <h3>Total Transaksi</h3>
                    <div class="amount" id="totalTransactions">0</div>
                </div>
            </div>

            <div class="toggle-header" onclick="toggleRecentTransactions()">
                <h3 style="margin-top: 30px; margin-bottom: 15px; color: #333;">
                    <span class="toggle-arrow" id="recentArrow">‚ñº</span>
                    Transaksi Terakhir
                </h3>
            </div>
            <div id="recentTransactions" class="collapsible-content"></div>
        </div>

        <!-- Transaksi Tab -->
        <div id="transaksi" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #333;">Tambah Transaksi Baru</h2>
            
            <div id="successMessage" style="display: none;" class="alert alert-success">
                Transaksi berhasil ditambahkan!
            </div>

            <div id="alertMessage" style="display: none;"></div>

            <div id="transactionFormWrapper">
                <form id="transactionForm">
                    <div class="form-group">
                        <label for="tanggal">Tanggal</label>
                        <input type="date" id="tanggal" required>
                    </div>

                    <div class="form-group">
                        <label for="tipe">Tipe Transaksi</label>
                        <select id="tipe" required>
                            <option value="">Pilih Tipe</option>
                            <option value="income">Pemasukan</option>
                            <option value="expense">Pengeluaran</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="kategori">Kategori</label>
                        <select id="kategori" required>
                            <option value="">Pilih Kategori</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="jumlah">Jumlah (Rp)</label>
                        <input type="number" id="jumlah" min="0" step="1000" required>
                    </div>

                    <div class="form-group">
                        <label for="keterangan">Keterangan</label>
                        <textarea id="keterangan" rows="3" placeholder="Masukkan keterangan transaksi..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary" id="btnSubmit">Simpan Transaksi</button>
                </form>
            </div>

            <h3 style="margin-top: 40px; margin-bottom: 15px; color: #333;">Daftar Transaksi</h3>
            <div id="transactionListWrapper">
                <div id="transactionList"></div>
            </div>
            <div id="viewerNotice" style="display: none;">
                <div style="background: #fff3cd; border: 2px solid #ffc107; border-radius: 10px; padding: 30px; text-align: center; margin-top: 20px;">
                    <h3 style="color: #856404; margin-bottom: 15px;">üîí Akses Terbatas</h3>
                    <button class="btn btn-primary" onclick="logout()" style="margin-top: 20px;">Login sebagai Editor</button>
                </div>
            </div>
        </div>

        <!-- Laporan Tab -->
        <div id="laporan" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #333;">Laporan Keuangan</h2>
            
            <div class="report-section">
                <h3>Ringkasan Keuangan</h3>
                <table>
                    <tbody>
                        <tr>
                            <td><strong>Total Pemasukan</strong></td>
                            <td class="income" id="reportIncome">Rp 0</td>
                        </tr>
                        <tr>
                            <td><strong>Total Pengeluaran</strong></td>
                            <td class="expense" id="reportExpense">Rp 0</td>
                        </tr>
                        <tr>
                            <td><strong>Saldo Akhir</strong></td>
                            <td id="reportBalance">Rp 0</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="report-section">
                <h3>Pemasukan per Kategori</h3>
                <div id="incomeByCategory"></div>
            </div>

            <div class="report-section">
                <h3>Pengeluaran per Kategori</h3>
                <div id="expenseByCategory"></div>
            </div>
        </div>

        <!-- Kategori Tab -->
        <div id="Kategori" class="tab-content">
            <h2 style="margin-bottom: 20px; color: #333;">Kelola Kategori</h2>

            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                <div>
                    <h3 style="margin-bottom: 15px; color: #333;">Kategori Pemasukan</h3>
                    <ul id="incomeCategories" style="list-style: none; padding: 0;"></ul>
                </div>
                <div>
                    <h3 style="margin-bottom: 15px; color: #333;">Kategori Pengeluaran</h3>
                    <ul id="expenseCategories" style="list-style: none; padding: 0;"></ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Authentication Variables
        let isEditor = false;
        const CORRECT_PASSWORD = "VIM19";
        let editingTransactionId = null;
        let recentTransactionsVisible = true;

        // Data Storage
        let transactions = JSON.parse(localStorage.getItem('transactions')) || [];
        let categories = JSON.parse(localStorage.getItem('categories')) || {
            income: ['Penjualan Telur', 'Penjualan Pupuk', 'Penjualan Hasil Tani', 'Lainnya'],
            expense: ['Operasional', 'ATK', 'Vitamin', 'Lainnya']
        };

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            showLoginModal();
        });

        // Login Functions
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'block';
        }

        function loginAsViewer() {
            isEditor = false;
            document.getElementById('loginModal').style.display = 'none';
            updateAuthStatus();
            lockEditorFeatures();
            initializeApp();
            showAlertMessage('Login sebagai Viewer. Anda hanya dapat melihat data.', 'warning');
        }

        function loginWithPassword() {
            const password = document.getElementById('passwordInput').value;
            
            if (password === CORRECT_PASSWORD) {
                isEditor = true;
                document.getElementById('loginModal').style.display = 'none';
                updateAuthStatus();
                unlockEditorFeatures();
                initializeApp();
                showAlertMessage('Login berhasil! Anda dapat mengedit data.', 'success');
            } else if (password === '') {
                showAlertMessage('Silakan masukkan password atau pilih "Lihat Saja"', 'error');
            } else {
                showAlertMessage('Password salah! Silakan coba lagi.', 'error');
            }
        }

        function logout() {
            if (confirm('Anda yakin ingin logout?')) {
                isEditor = false;
                document.getElementById('passwordInput').value = '';
                showLoginModal();
                updateAuthStatus();
                lockEditorFeatures();
            }
        }

        function updateAuthStatus() {
            const badge = document.getElementById('authBadge');
            if (isEditor) {
                badge.textContent = 'Editor';
                badge.className = 'auth-badge editor';
            } else {
                badge.textContent = 'Viewer';
                badge.className = 'auth-badge viewer';
            }
        }

        function lockEditorFeatures() {
            // Lock transaction form
            const formWrapper = document.getElementById('transactionFormWrapper');
            if (!formWrapper.classList.contains('locked-overlay')) {
                formWrapper.classList.add('locked-overlay');
            }
            
            // Hide transaction list for viewers
            const transactionListWrapper = document.getElementById('transactionListWrapper');
            transactionListWrapper.style.display = 'none';
            
            // Show viewer notice
            const viewerNotice = document.getElementById('viewerNotice');
            viewerNotice.style.display = 'block';
            
            // Disable all delete buttons
            updateTransactionList();
        }

        function unlockEditorFeatures() {
            // Unlock transaction form
            const formWrapper = document.getElementById('transactionFormWrapper');
            formWrapper.classList.remove('locked-overlay');
            
            // Show transaction list for editors
            const transactionListWrapper = document.getElementById('transactionListWrapper');
            transactionListWrapper.style.display = 'block';
            
            // Hide viewer notice
            const viewerNotice = document.getElementById('viewerNotice');
            viewerNotice.style.display = 'none';
            
            // Enable all delete buttons
            updateTransactionList();
        }

        function showAlertMessage(message, type) {
            const alertDiv = document.getElementById('alertMessage');
            alertDiv.textContent = message;
            alertDiv.className = `alert alert-${type}`;
            alertDiv.style.display = 'block';
            
            setTimeout(() => {
                alertDiv.style.display = 'none';
            }, 5000);
        }

        // Toggle Recent Transactions
        function toggleRecentTransactions() {
            recentTransactionsVisible = !recentTransactionsVisible;
            const recentDiv = document.getElementById('recentTransactions');
            const arrow = document.getElementById('recentArrow');
            
            if (recentTransactionsVisible) {
                recentDiv.classList.remove('collapsed');
                arrow.classList.remove('collapsed');
                arrow.textContent = '‚ñº';
            } else {
                recentDiv.classList.add('collapsed');
                arrow.classList.add('collapsed');
                arrow.textContent = '‚ñº';
            }
        }

        function initializeApp() {
            document.getElementById('tanggal').valueAsDate = new Date();
            updateDashboard();
            updateTransactionList();
            updateReport();
            updateCategoryList();
            updateCategoryOptions();
            
            // Add event listener for edit form category change
            document.getElementById('editTipe').addEventListener('change', updateEditCategoryOptions);
        }

        // Edit Transaction Functions
        function openEditModal(id) {
            if (!isEditor) {
                alert('Anda tidak memiliki akses untuk mengedit transaksi!');
                return;
            }

            const transaction = transactions.find(t => t.id === id);
            if (!transaction) return;

            editingTransactionId = id;
            document.getElementById('editTanggal').value = transaction.tanggal;
            document.getElementById('editTipe').value = transaction.tipe;
            
            // Update category options based on type
            updateEditCategoryOptions();
            
            document.getElementById('editKategori').value = transaction.kategori;
            document.getElementById('editJumlah').value = transaction.jumlah;
            document.getElementById('editKeterangan').value = transaction.keterangan;

            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            editingTransactionId = null;
        }

        function updateEditCategoryOptions() {
            const tipe = document.getElementById('editTipe').value;
            const kategoriSelect = document.getElementById('editKategori');
            kategoriSelect.innerHTML = '<option value="">Pilih Kategori</option>';
            
            if (tipe) {
                categories[tipe].forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    kategoriSelect.appendChild(option);
                });
            }
        }

        // Handle Edit Form Submit
        document.getElementById('editTransactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!isEditor || !editingTransactionId) return;

            const index = transactions.findIndex(t => t.id === editingTransactionId);
            if (index === -1) return;

            transactions[index] = {
                id: editingTransactionId,
                tanggal: document.getElementById('editTanggal').value,
                tipe: document.getElementById('editTipe').value,
                kategori: document.getElementById('editKategori').value,
                jumlah: parseFloat(document.getElementById('editJumlah').value),
                keterangan: document.getElementById('editKeterangan').value
            };

            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            // Show success message
            const successMsg = document.getElementById('successMessage');
            successMsg.textContent = 'Transaksi berhasil diperbarui!';
            successMsg.style.display = 'block';
            setTimeout(() => {
                successMsg.style.display = 'none';
                successMsg.textContent = 'Transaksi berhasil ditambahkan!';
            }, 3000);

            closeEditModal();
            updateDashboard();
            updateTransactionList();
            updateReport();
        });

        // Tab Navigation
        function showTab(tabName) {
            const tabs = document.querySelectorAll('.tab-content');
            const navTabs = document.querySelectorAll('.nav-tab');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            navTabs.forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
            
            if (tabName === 'dashboard') updateDashboard();
            if (tabName === 'laporan') updateReport();
        }

        // Update Category Options
        document.getElementById('tipe').addEventListener('change', updateCategoryOptions);

        function updateCategoryOptions() {
            const tipe = document.getElementById('tipe').value;
            const kategoriSelect = document.getElementById('kategori');
            kategoriSelect.innerHTML = '<option value="">Pilih Kategori</option>';
            
            if (tipe) {
                categories[tipe].forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat;
                    option.textContent = cat;
                    kategoriSelect.appendChild(option);
                });
            }
        }

        // Form Submit
        document.getElementById('transactionForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!isEditor) {
                showAlertMessage('Anda tidak memiliki akses untuk menambah transaksi!', 'error');
                return;
            }
            
            const transaction = {
                id: Date.now(),
                tanggal: document.getElementById('tanggal').value,
                tipe: document.getElementById('tipe').value,
                kategori: document.getElementById('kategori').value,
                jumlah: parseFloat(document.getElementById('jumlah').value),
                keterangan: document.getElementById('keterangan').value
            };
            
            transactions.push(transaction);
            localStorage.setItem('transactions', JSON.stringify(transactions));
            
            // Show success message
            const successMsg = document.getElementById('successMessage');
            successMsg.style.display = 'block';
            setTimeout(() => successMsg.style.display = 'none', 3000);
            
            // Reset form
            this.reset();
            document.getElementById('tanggal').valueAsDate = new Date();
            
            updateDashboard();
            updateTransactionList();
            updateReport();
        });

        // Update Dashboard
        function updateDashboard() {
            const income = transactions
                .filter(t => t.tipe === 'income')
                .reduce((sum, t) => sum + t.jumlah, 0);
            
            const expense = transactions
                .filter(t => t.tipe === 'expense')
                .reduce((sum, t) => sum + t.jumlah, 0);
            
            const balance = income - expense;
            
            document.getElementById('totalIncome').textContent = formatCurrency(income);
            document.getElementById('totalExpense').textContent = formatCurrency(expense);
            document.getElementById('balance').textContent = formatCurrency(balance);
            document.getElementById('totalTransactions').textContent = transactions.length;
            
            // Recent transactions
            const recent = transactions.slice(-5).reverse();
            const recentDiv = document.getElementById('recentTransactions');
            
            if (recent.length === 0) {
                recentDiv.innerHTML = '<div class="no-data">Belum ada transaksi</div>';
            } else {
                recentDiv.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Kategori</th>
                                <th>Keterangan</th>
                                <th>Jumlah</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${recent.map(t => `
                                <tr>
                                    <td>${formatDate(t.tanggal)}</td>
                                    <td>${t.kategori}</td>
                                    <td>${t.keterangan || '-'}</td>
                                    <td class="${t.tipe === 'income' ? 'income' : 'expense'}">
                                        ${t.tipe === 'income' ? '+' : '-'} ${formatCurrency(t.jumlah)}
                                    </td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
        }

        // Update Transaction List
        function updateTransactionList() {
            const listDiv = document.getElementById('transactionList');
            
            if (transactions.length === 0) {
                listDiv.innerHTML = '<div class="no-data">Belum ada transaksi</div>';
                return;
            }
            
            const sorted = [...transactions].sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
            
            listDiv.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>Tanggal</th>
                            <th>Tipe</th>
                            <th>Kategori</th>
                            <th>Keterangan</th>
                            <th>Jumlah</th>
                            <th>Aksi</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${sorted.map(t => `
                            <tr>
                                <td>${formatDate(t.tanggal)}</td>
                                <td>${t.tipe === 'income' ? 'Pemasukan' : 'Pengeluaran'}</td>
                                <td>${t.kategori}</td>
                                <td>${t.keterangan || '-'}</td>
                                <td class="${t.tipe === 'income' ? 'income' : 'expense'}">
                                    ${formatCurrency(t.jumlah)}
                                </td>
                                <td>
                                    <div class="action-buttons">
                                        <button class="btn btn-warning" onclick="openEditModal(${t.id}); return false;" ${!isEditor ? 'disabled' : ''}>
                                            Edit
                                        </button>
                                        <button class="btn btn-danger" onclick="deleteTransaction(${t.id}); return false;" ${!isEditor ? 'disabled' : ''}>
                                            Hapus
                                        </button>
                                    </div>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }

        // Delete Transaction
        function deleteTransaction(id) {
            if (!isEditor) {
                alert('Anda tidak memiliki akses untuk menghapus transaksi!');
                return false;
            }

            if (confirm('Yakin ingin menghapus transaksi ini?')) {
                transactions = transactions.filter(t => t.id !== id);
                localStorage.setItem('transactions', JSON.stringify(transactions));
                updateDashboard();
                updateTransactionList();
                updateReport();
                
                // Show success message
                const successMsg = document.getElementById('successMessage');
                successMsg.textContent = 'Transaksi berhasil dihapus!';
                successMsg.style.display = 'block';
                setTimeout(() => {
                    successMsg.style.display = 'none';
                    successMsg.textContent = 'Transaksi berhasil ditambahkan!';
                }, 3000);
            }
            return false;
        }

        // Update Report
        function updateReport() {
            const income = transactions
                .filter(t => t.tipe === 'income')
                .reduce((sum, t) => sum + t.jumlah, 0);
            
            const expense = transactions
                .filter(t => t.tipe === 'expense')
                .reduce((sum, t) => sum + t.jumlah, 0);
            
            const balance = income - expense;
            
            document.getElementById('reportIncome').textContent = formatCurrency(income);
            document.getElementById('reportExpense').textContent = formatCurrency(expense);
            document.getElementById('reportBalance').textContent = formatCurrency(balance);
            document.getElementById('reportBalance').className = balance >= 0 ? 'income' : 'expense';
            
            // Income by category
            const incomeByCategory = {};
            transactions.filter(t => t.tipe === 'income').forEach(t => {
                incomeByCategory[t.kategori] = (incomeByCategory[t.kategori] || 0) + t.jumlah;
            });
            
            const incomeDiv = document.getElementById('incomeByCategory');
            if (Object.keys(incomeByCategory).length === 0) {
                incomeDiv.innerHTML = '<div class="no-data">Belum ada data pemasukan</div>';
            } else {
                incomeDiv.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Kategori</th>
                                <th>Jumlah</th>
                                <th>Persentase</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(incomeByCategory).map(([cat, amount]) => `
                                <tr>
                                    <td>${cat}</td>
                                    <td class="income">${formatCurrency(amount)}</td>
                                    <td>${((amount/income)*100).toFixed(1)}%</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
            
            // Expense by category
            const expenseByCategory = {};
            transactions.filter(t => t.tipe === 'expense').forEach(t => {
                expenseByCategory[t.kategori] = (expenseByCategory[t.kategori] || 0) + t.jumlah;
            });
            
            const expenseDiv = document.getElementById('expenseByCategory');
            if (Object.keys(expenseByCategory).length === 0) {
                expenseDiv.innerHTML = '<div class="no-data">Belum ada data pengeluaran</div>';
            } else {
                expenseDiv.innerHTML = `
                    <table>
                        <thead>
                            <tr>
                                <th>Kategori</th>
                                <th>Jumlah</th>
                                <th>Persentase</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${Object.entries(expenseByCategory).map(([cat, amount]) => `
                                <tr>
                                    <td>${cat}</td>
                                    <td class="expense">${formatCurrency(amount)}</td>
                                    <td>${((amount/expense)*100).toFixed(1)}%</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                `;
            }
        }

        // Update Category List
        function updateCategoryList() {
            const incomeList = document.getElementById('incomeCategories');
            const expenseList = document.getElementById('expenseCategories');
            
            incomeList.innerHTML = categories.income.map(cat => `
                <li style="padding: 10px; background: #f8f9fa; margin-bottom: 5px; border-radius: 5px;">
                    ${cat}
                </li>
            `).join('');
            
            expenseList.innerHTML = categories.expense.map(cat => `
                <li style="padding: 10px; background: #f8f9fa; margin-bottom: 5px; border-radius: 5px;">
                    ${cat}
                </li>
            `).join('');
        }

        // Utility Functions
        function formatCurrency(amount) {
            return new Intl.NumberFormat('id-ID', {
                style: 'currency',
                currency: 'IDR',
                minimumFractionDigits: 0
            }).format(amount);
        }

        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'short', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }
    </script>
</body>
</html>